{
  "dry_run": false,
  "steps": [
    { "type": "write_files",
      "files": {
        "src/ServerScriptService/Net/RateLimiter.lua": {
          "encoding": "utf8",
          "content": "local RateLimiter = {}\n\nlocal DEFAULT_LIMITS = { calls = 10, per = 1 } -- 10 calls per second\nlocal buckets = {} -- [key][name] = {calls, windowStart}\n\nfunction RateLimiter:getKey(player)\n\treturn player and (\"p:\" .. player.UserId) or \"server\"\nend\n\nfunction RateLimiter:allowed(key, name, limits)\n\tlimits = limits or DEFAULT_LIMITS\n\tlocal now = os.clock()\n\tbuckets[key] = buckets[key] or {}\n\tlocal b = buckets[key][name]\n\tif not b or now - b.windowStart >= limits.per then\n\t\tb = { calls = 0, windowStart = now }\n\t\tbuckets[key][name] = b\n\tend\n\tif b.calls < limits.calls then\n\t\tb.calls += 1\n\t\treturn true\n\telse\n\t\treturn false\n\tend\nend\n\nreturn RateLimiter\n"
        },
        "src/ServerScriptService/Net/InitRemotes.server.lua": {
          "encoding": "utf8",
          "content": "local ReplicatedStorage = game:GetService(\"ReplicatedStorage\")\nlocal RateLimiter = require(script.Parent.RateLimiter)\n\nlocal remotesFolder = ReplicatedStorage:FindFirstChild(\"Remotes\") or Instance.new(\"Folder\")\nremotesFolder.Name = \"Remotes\"\nremotesFolder.Parent = ReplicatedStorage\n\nlocal function getOrCreateRemote(name, className)\n\tlocal r = remotesFolder:FindFirstChild(name)\n\tif not r then\n\t\tr = Instance.new(className)\n\t\tr.Name = name\n\t\tr.Parent = remotesFolder\n\tend\n\treturn r\nend\n\nlocal ClientPing = getOrCreateRemote(\"ClientPing\",\"RemoteFunction\")\nlocal RequestJoin = getOrCreateRemote(\"RequestJoin\",\"RemoteFunction\")\nlocal KickBall = getOrCreateRemote(\"KickBall\",\"RemoteEvent\")\n\nClientPing.OnServerInvoke = function(player, payload)\n\tif not RateLimiter:allowed(RateLimiter:getKey(player),\"ClientPing\",{calls=3, per=1}) then\n\t\treturn { ok=false, err=\"rate_limited\" }\n\tend\n\treturn { ok=true, serverTime=os.clock(), echo=payload }\nend\n\nRequestJoin.OnServerInvoke = function(player)\n\tif not RateLimiter:allowed(RateLimiter:getKey(player),\"RequestJoin\",{calls=2, per=5}) then\n\t\treturn { ok=false, err=\"rate_limited\" }\n\tend\n\treturn { ok=true }\nend\n\nKickBall.OnServerEvent:Connect(function(player, impulse)\n\tif not RateLimiter:allowed(RateLimiter:getKey(player),\"KickBall\",{calls=4, per=1}) then\n\t\treturn\n\tend\n\t-- server-side physics will apply kick later\nend)\n\nprint(\"[Net] Remotes initialized.\")\n"
        },
        "src/ReplicatedStorage/Shared/Constants.lua": {
          "encoding": "utf8",
          "content": "local Constants = {}\n\nConstants.FIELD_CENTER = Vector3.new(0,0,0)\nConstants.HOME_GOAL_POS = Vector3.new(-150,5,0)\nConstants.AWAY_GOAL_POS = Vector3.new(150,5,0)\n\nConstants.BOT = {\n\tTICK = 0.10,\n\tMAX_SPEED = 18,\n\tCHASE_RADIUS = 300,\n\tKICK_RANGE = 7.5,\n\tKICK_POWER = 60,\n\tDRIBBLE_POWER = 18,\n\tRETARGET_SEC = 0.5,\n}\n\nreturn Constants\n"
        }
      }
    },
    { "type": "validate",
      "checks": [
        { "op": "file_exists", "path": "src/ServerScriptService/Net/RateLimiter.lua" },
        { "op": "file_exists", "path": "src/ServerScriptService/Net/InitRemotes.server.lua" },
        { "op": "file_exists", "path": "src/ReplicatedStorage/Shared/Constants.lua" },
        { "op": "text_contains", "path": "src/ServerScriptService/Net/InitRemotes.server.lua", "substr": "[Net] Remotes initialized." },
        { "op": "text_contains", "path": "src/ServerScriptService/Net/RateLimiter.lua", "substr": "DEFAULT_LIMITS" },
        { "op": "text_contains", "path": "src/ReplicatedStorage/Shared/Constants.lua", "substr": "Constants.BOT" }
      ]
    }
  ]
}
