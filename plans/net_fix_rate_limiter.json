{
  "dry_run": false,
  "steps": [
    { "type": "write_files",
      "files": {
        "src/ServerScriptService/Net/RateLimiter.lua": {
          "encoding": "utf8",
          "content": "local RateLimiter = {}\n\nlocal DEFAULT_LIMITS = { calls = 10, per = 1 } -- 10 calls per second\nlocal buckets = {} -- [key][name] = {calls, windowStart}\n\nfunction RateLimiter:getKey(player)\n\treturn player and (\"p:\" .. player.UserId) or \"server\"\nend\n\nfunction RateLimiter:allowed(key, name, limits)\n\tlimits = limits or DEFAULT_LIMITS\n\tlocal now = os.clock()\n\tbuckets[key] = buckets[key] or {}\n\tlocal b = buckets[key][name]\n\tif not b or now - b.windowStart >= limits.per then\n\t\tb = { calls = 0, windowStart = now }\n\t\tbuckets[key][name] = b\n\tend\n\tif b.calls < limits.calls then\n\t\tb.calls = b.calls + 1\n\t\treturn true\n\telse\n\t\treturn false\n\tend\nend\n\nreturn RateLimiter\n"
        }
      }
    },
    { "type": "validate",
      "checks": [
        { "op": "text_contains", "path": "src/ServerScriptService/Net/RateLimiter.lua", "substr": "b.calls = b.calls + 1" }
      ]
    }
  ]
}
