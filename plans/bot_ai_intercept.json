{
  "dry_run": false,
  "steps": [
    { "type": "write_files",
      "files": {
        "src/ServerScriptService/Bot/BotAI.lua": {
          "encoding": "utf8",
          "content": "local Players = game:GetService(\"Players\")\nlocal RunService = game:GetService(\"RunService\")\nlocal ReplicatedStorage = game:GetService(\"ReplicatedStorage\")\nlocal Constants = require(ReplicatedStorage.Shared.Constants)\n\nlocal BotAI = {}\nBotAI.__index = BotAI\n\nlocal function getBall()\n\tlocal b = workspace:FindFirstChild(\"Ball\")\n\tif b and b:IsA(\"BasePart\") then return b end\n\treturn nil\nend\n\nlocal function distance(a: Vector3, b: Vector3)\n\treturn (a - b).Magnitude\nend\n\nfunction BotAI.new(model: Model)\n\tlocal self = setmetatable({}, BotAI)\n\tself.model = model\n\tself.hum = model:FindFirstChildOfClass(\"Humanoid\")\n\tself.root = model:FindFirstChild(\"HumanoidRootPart\")\n\tself._accum = 0\n\tself._retarget = 0\n\treturn self\nend\n\nfunction BotAI:step(dt)\n\tif not self.hum or not self.root then return end\n\tself._accum = self._accum + dt\n\tself._retarget = self._retarget + dt\n\tif self._accum < Constants.BOT.TICK then return end\n\tself._accum = 0\n\n\tlocal ball = getBall()\n\tif not ball then return end\n\n\tlocal botPos = self.root.Position\n\tlocal ballPos = ball.Position\n\tlocal dist = distance(botPos, ballPos)\n\n\t-- Predictive intercept: estimate where the ball will be shortly\n\tlocal ballVel = ball.AssemblyLinearVelocity or Vector3.zero\n\tlocal botSpeed = Constants.BOT.MAX_SPEED\n\tlocal t = math.clamp(dist / math.max(botSpeed, 0.01), 0.2, 0.8)\n\tlocal predicted = ballPos + ballVel * t\n\n\t-- Move toward predicted intercept point until in kick range\n\tif (botPos - ballPos).Magnitude > Constants.BOT.KICK_RANGE then\n\t\tself.hum.WalkSpeed = botSpeed\n\t\tself.hum:MoveTo(predicted)\n\t\treturn\n\tend\n\n\t-- Kick/dribble on contact range (server authority)\n\tlocal dir = (ballPos - botPos)\n\tif dir.Magnitude <= 0 then return end\n\tdir = dir.Unit\n\tlocal power = Constants.BOT.KICK_POWER\n\tlocal goalDir = (Constants.AWAY_GOAL_POS - ballPos).Unit\n\tlocal impulse = (dir + goalDir) * power\n\tlocal lv = Instance.new(\"LinearVelocity\")\n\tlv.Name = \"BotKickLV\"\n\tlv.VectorVelocity = impulse\n\tlv.Attachment0 = nil\n\tlv.RelativeTo = Enum.ActuatorRelativeTo.World\n\tlv.MaxForce = math.huge\n\tlv.Parent = ball\n\tgame.Debris:AddItem(lv, 0.15)\nend\n\nreturn BotAI\n"
        }
      }
    },
    { "type": "validate",
      "checks": [
        { "op": "text_contains", "path": "src/ServerScriptService/Bot/BotAI.lua", "substr": "Predictive intercept" },
        { "op": "text_contains", "path": "src/ServerScriptService/Bot/BotAI.lua", "substr": "AssemblyLinearVelocity" }
      ]
    }
  ]
}
